<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.simg.simgoti.mapper.ApplyMapper">

    <select id="selectClientList" resultType="com.simg.simgoti.dto.ClientDto">
        select
            *
        from
            client
        where
            useYN = "Y";
    </select>

    <select id="selectCoverageList" resultType="com.simg.simgoti.dto.CoverageDto">
        select
            c.covCode, c.covNm, c.covPremium, c.covPremiumMin, d.covDCode, covDNm, covDAmt
        from
            simgotidb.coverage c
        join
            simgotidb.coverageDetail d
        on
            c.covCode = d.covCode
        where
            c.useYN = 'Y' and d.useYN = 'Y';
    </select>

    <select id="selectCoverageTypeList" resultType="com.simg.simgoti.dto.CoverageTypeDto">
        select
            covCode, covNm, covPremium, covPremiumMin
        from
            simgotidb.coverage
        where
            useYN = 'Y';
    </select>

    <select id="selectPremium" resultType="Map">
        select
            covPremium, covPremiumMin
        from
            simgotidb.coverage
        where
            covCode = #{covCode} and useYN = 'Y';
    </select>

    <insert id="insertRepClient" useGeneratedKeys="true" keyProperty="clntPk">
        insert into
            simgotidb.client (clntNm, clntBirth, clntGen, clntJumin, clntPhone, clntEmail)
        values
            (#{clntNm}, #{clntBirth}, #{clntGen}, #{clntJumin}, #{clntPhone}, #{clntEmail})
    </insert>

    <select id="selectClientNmJumin" resultType="int">
        select
            clntPk
        from
            simgotidb.client
        where
            clntNm = #{clntNm} and clntJumin = #{clntJumin} and useYN = 'Y';
    </select>

    <update id="updateClientPhoneEmailByPk" >
        update
            simgotidb.client
        set
            clntPhone = #{clntPhone}, clntEmail = #{clntEmail}, clntUdt = now()
        where
            clntPk = #{clntPk} and useYN = 'Y';
    </update>

    <insert id="insertApplyPayment" useGeneratedKeys="true" keyProperty="payPk">
        insert into
            simgotidb.payment (premium, payDueDt)
        values
            (#{premium}, #{payDueDt});
    </insert>

    <insert id="insertApplyFinish" useGeneratedKeys="true" keyProperty="aplPk">
        insert into
            simgotidb.application (payPk, polNo, comCode, insComCode, clntPk, trPurpose, trPlace, trFromDt, trToDt, covCode, clntCnt, premium)
        values
            (#{payPk}, #{polNo}, #{comCode}, #{insComCode}, #{clntPk}, #{trPurpose}, #{trPlace}, #{trFromDt}, #{trToDt}, #{covCode}, #{clntCnt}, #{premium});
    </insert>

    <insert id="insertApplyInsuredList">
        insert into
            simgotidb.applicationInsuredList (aplPk, clntPk, repYN)
        values
            (#{aplPk}, #{clntPk}, #{repYN});
    </insert>

</mapper>

